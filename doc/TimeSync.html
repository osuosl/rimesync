<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class TimeSync - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/darkfish.js"></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Object
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-auth">#auth</a>
    
    <li ><a href="#method-i-authenticate">#authenticate</a>
    
    <li ><a href="#method-i-construct_filter_query">#construct_filter_query</a>
    
    <li ><a href="#method-i-create_activity">#create_activity</a>
    
    <li ><a href="#method-i-create_or_update">#create_or_update</a>
    
    <li ><a href="#method-i-create_project">#create_project</a>
    
    <li ><a href="#method-i-create_time">#create_time</a>
    
    <li ><a href="#method-i-create_user">#create_user</a>
    
    <li ><a href="#method-i-delete_activity">#delete_activity</a>
    
    <li ><a href="#method-i-delete_object">#delete_object</a>
    
    <li ><a href="#method-i-delete_project">#delete_project</a>
    
    <li ><a href="#method-i-delete_time">#delete_time</a>
    
    <li ><a href="#method-i-delete_user">#delete_user</a>
    
    <li ><a href="#method-i-duration_to_seconds">#duration_to_seconds</a>
    
    <li ><a href="#method-i-format_endpoints">#format_endpoints</a>
    
    <li ><a href="#method-i-get_activities">#get_activities</a>
    
    <li ><a href="#method-i-get_field_errors">#get_field_errors</a>
    
    <li ><a href="#method-i-get_projects">#get_projects</a>
    
    <li ><a href="#method-i-get_times">#get_times</a>
    
    <li ><a href="#method-i-get_users">#get_users</a>
    
    <li ><a href="#method-i-hash_user_password">#hash_user_password</a>
    
    <li ><a href="#method-i-local_auth_error">#local_auth_error</a>
    
    <li ><a href="#method-i-project_users">#project_users</a>
    
    <li ><a href="#method-i-response_to_ruby">#response_to_ruby</a>
    
    <li ><a href="#method-i-test_handler">#test_handler</a>
    
    <li ><a href="#method-i-token_auth">#token_auth</a>
    
    <li ><a href="#method-i-token_expiration_time">#token_expiration_time</a>
    
    <li ><a href="#method-i-update_activity">#update_activity</a>
    
    <li ><a href="#method-i-update_project">#update_project</a>
    
    <li ><a href="#method-i-update_time">#update_time</a>
    
    <li ><a href="#method-i-update_user">#update_user</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-TimeSync">
  <h1 id="class-TimeSync" class="class">
    class TimeSync
  </h1>

  <section class="description">
    
  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(baseurl, token = nil, test = false)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 40</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">baseurl</span>, <span class="ruby-identifier">token</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">test</span> = <span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">baseurl</span>.<span class="ruby-identifier">end_with?</span> <span class="ruby-string">&quot;/&quot;</span>
    <span class="ruby-ivar">@baseurl</span> = <span class="ruby-identifier">baseurl</span>.<span class="ruby-identifier">chop</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@baseurl</span> = <span class="ruby-identifier">baseurl</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@user</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@password</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@auth_type</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@token</span> = <span class="ruby-identifier">token</span>
  <span class="ruby-ivar">@error</span> = <span class="ruby-string">&#39;rimesync error&#39;</span>
  <span class="ruby-ivar">@test</span> = <span class="ruby-identifier">test</span>

  <span class="ruby-ivar">@valid_get_queries</span> = <span class="ruby-constant">Array</span>[<span class="ruby-string">&#39;user&#39;</span>, <span class="ruby-string">&#39;project&#39;</span>, <span class="ruby-string">&#39;activity&#39;</span>,
                            <span class="ruby-string">&#39;start&#39;</span>, <span class="ruby-string">&#39;end&#39;</span>, <span class="ruby-string">&#39;include_revisions&#39;</span>,
                            <span class="ruby-string">&#39;include_deleted&#39;</span>, <span class="ruby-string">&#39;uuid&#39;</span>]
  <span class="ruby-ivar">@required_params</span> = <span class="ruby-constant">Hash</span>[
      <span class="ruby-string">&#39;time&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">%w(duration project user date_worked)</span>,
      <span class="ruby-string">&#39;project&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">%w(name slugs)</span>,
      <span class="ruby-string">&#39;activity&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">%w(name slug)</span>,
      <span class="ruby-string">&#39;user&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">%w(username password)</span>
  ]
  <span class="ruby-ivar">@optional_params</span> = <span class="ruby-constant">Hash</span>[
      <span class="ruby-string">&#39;time&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">%w(notes issue_uri activities)</span>,
      <span class="ruby-string">&#39;project&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">%w(uri users default_activity)</span>,
      <span class="ruby-string">&#39;activity&#39;</span> =<span class="ruby-operator">&gt;</span> [],
      <span class="ruby-string">&#39;user&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">%w(display_name email site_admin site_spectator
      site_manager meta active)</span>
  ]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-auth" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">auth</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns auth object to log in to <a href="TimeSync.html">TimeSync</a></p>
          
          

          
          <div class="method-source-code" id="auth-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 717</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">auth</span>
  <span class="ruby-constant">Hash</span>[<span class="ruby-string">&#39;type&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@auth_type</span>,
       <span class="ruby-string">&#39;username&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@user</span>,
       <span class="ruby-string">&#39;password&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@password</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-authenticate" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">authenticate</span><span
            class="method-args">(username: nil, password: nil, auth_type: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>authenticate(username, password, auth_type) Authenticate a username and
password with <a href="TimeSync.html">TimeSync</a> via a POST request to
the login endpoint. This method will return a list containing a single ruby
hash. If successful, the hash will contain the token in the form
[{&#39;token&#39;: &#39;SOMETOKEN&#39;}]. If an error is returned the hash
will contain the error information. “username“ is a string containing the
username of the <a href="TimeSync.html">TimeSync</a> user “password“ is a
string containing the user&#39;s password “auth_type“ is a string
containing the authentication method used by <a
href="TimeSync.html">TimeSync</a> rubocop:disable MethodLength</p>
          
          

          
          <div class="method-source-code" id="authenticate-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 82</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">authenticate</span>(<span class="ruby-identifier">username</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">password</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">auth_type</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-comment"># Check for correct arguments in method call</span>
  <span class="ruby-identifier">arg_error_list</span> = <span class="ruby-constant">Array</span>[]

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">username</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">arg_error_list</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">&#39;username&#39;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">password</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">arg_error_list</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">&#39;password&#39;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">auth_type</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">arg_error_list</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">&#39;auth_type&#39;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">arg_error_list</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;Missing %s; please add to method call&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-constant">Array</span>[<span class="ruby-identifier">arg_error_list</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;, &#39;</span>)]]
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">arg_error_list</span>.<span class="ruby-identifier">clear</span>

  <span class="ruby-ivar">@user</span> = <span class="ruby-identifier">username</span>
  <span class="ruby-ivar">@password</span> = <span class="ruby-identifier">password</span>
  <span class="ruby-ivar">@auth_type</span> = <span class="ruby-identifier">auth_type</span>

  <span class="ruby-comment"># Create the auth block to send to the login endpoint</span>
  <span class="ruby-identifier">auth_hash</span> = <span class="ruby-constant">Hash</span>[<span class="ruby-string">&#39;auth&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">auth</span>].<span class="ruby-identifier">to_json</span>

  <span class="ruby-comment"># Construct the url with the login endpoint</span>
  <span class="ruby-identifier">url</span> = <span class="ruby-string">&#39;%s/login&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-constant">Array</span>[<span class="ruby-ivar">@baseurl</span>]

  <span class="ruby-comment"># Test mode, set token and return it from the mocked method</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@test</span>
    <span class="ruby-ivar">@token</span> = <span class="ruby-string">&quot;TESTTOKEN&quot;</span>
    <span class="ruby-identifier">m</span> = <span class="ruby-constant">MockTimeSync</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">authenticate</span>
    <span class="ruby-comment"># return mock_rimesync.authenticate</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Send the request, then convert the resonse to a ruby hash</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-comment"># Success!</span>
    <span class="ruby-identifier">response</span> = <span class="ruby-constant">RestClient</span>.<span class="ruby-identifier">post</span>(<span class="ruby-identifier">url</span>, <span class="ruby-identifier">auth_hash</span>, <span class="ruby-value">:content_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:json</span>, <span class="ruby-value">:accept</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:json</span>)
    <span class="ruby-identifier">token_response</span> = <span class="ruby-identifier">response_to_ruby</span>(<span class="ruby-identifier">response</span>.<span class="ruby-identifier">body</span>, <span class="ruby-identifier">response</span>.<span class="ruby-identifier">code</span>)
  <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
    <span class="ruby-identifier">err_msg</span> = <span class="ruby-string">&#39;connection to TimeSync failed at baseurl %s - &#39;</span> <span class="ruby-operator">%</span> <span class="ruby-ivar">@baseurl</span>
    <span class="ruby-identifier">err_msg</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&#39;response status was %s&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">http_code</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err_msg</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># If TimeSync returns an error, return the error without setting the</span>
  <span class="ruby-comment"># token.</span>
  <span class="ruby-comment"># Else set the token to the returned token and return the dict.</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">token_response</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;error&#39;</span>) <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-identifier">token_response</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;token&#39;</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">token_response</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@token</span> = <span class="ruby-identifier">token_response</span>[<span class="ruby-string">&#39;token&#39;</span>]
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">token_response</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-construct_filter_query" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">construct_filter_query</span><span
            class="method-args">(queries)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Construct the query string for filtering GET queries, such as <a
href="TimeSync.html#method-i-get_times">#get_times</a></p>
          
          

          
          <div class="method-source-code" id="construct_filter_query-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 810</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">construct_filter_query</span>(<span class="ruby-identifier">queries</span>)
  <span class="ruby-identifier">query_string</span> = <span class="ruby-string">&#39;?&#39;</span>
  <span class="ruby-identifier">query_list</span> = <span class="ruby-constant">Array</span>[]

  <span class="ruby-comment"># Format the include_* queries similarly to other queries for easier</span>
  <span class="ruby-comment"># processing</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">queries</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;include_deleted&#39;</span>)
    <span class="ruby-identifier">queries</span>[<span class="ruby-string">&#39;include_deleted&#39;</span>] = <span class="ruby-identifier">queries</span>[<span class="ruby-string">&#39;include_deleted&#39;</span>] <span class="ruby-operator">?</span>
                                  [<span class="ruby-string">&#39;true&#39;</span>] <span class="ruby-operator">:</span> [<span class="ruby-string">&#39;false&#39;</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">queries</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;include_revisions&#39;</span>)
    <span class="ruby-identifier">queries</span>[<span class="ruby-string">&#39;include_revisions&#39;</span>] = (<span class="ruby-identifier">queries</span>[<span class="ruby-string">&#39;include_revisions&#39;</span>] <span class="ruby-operator">?</span> [<span class="ruby-string">&#39;true&#39;</span>] <span class="ruby-operator">:</span> [<span class="ruby-string">&#39;false&#39;</span>])
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># If uuid is included, the only other accepted queries are the</span>
  <span class="ruby-comment"># include_*s</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">queries</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;uuid&#39;</span>)
    <span class="ruby-identifier">query_string</span> = <span class="ruby-string">&#39;/%s?&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">queries</span>[<span class="ruby-string">&#39;uuid&#39;</span>]
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">queries</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;include_deleted&#39;</span>)
      <span class="ruby-comment"># query_string += &#39;include_deleted=%s&amp;&#39; % queries[&#39;include_deleted&#39;][0]</span>
      <span class="ruby-identifier">query_string</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">format</span>(<span class="ruby-string">&#39;include_deleted=%s&amp;&#39;</span>,
                             <span class="ruby-identifier">queries</span>[<span class="ruby-string">&#39;include_deleted&#39;</span>][<span class="ruby-value">0</span>])
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">queries</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;include_revisions&#39;</span>)
      <span class="ruby-comment"># query_string += &#39;include_revisions=%s&amp;&#39; % queries[&#39;include_revisions&#39;][0]</span>
      <span class="ruby-identifier">query_string</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">format</span>(<span class="ruby-string">&#39;include_revisions=%s&amp;&#39;</span>,
                             <span class="ruby-identifier">queries</span>[<span class="ruby-string">&#39;include_revisions&#39;</span>][<span class="ruby-value">0</span>])
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># Everthing is a list now, so iterate through and push</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment"># Sort them into an alphabetized list for easier testing</span>
    <span class="ruby-comment"># sorted_qs = sorted(queries.to_a, key = operator.itemgetter(0))</span>
    <span class="ruby-identifier">sorted_qs</span> = <span class="ruby-identifier">queries</span>.<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">sort</span>
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">query</span>, <span class="ruby-identifier">param</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">sorted_qs</span>
      <span class="ruby-keyword">for</span> <span class="ruby-identifier">slug</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">param</span>
        <span class="ruby-comment"># Format each query in the list</span>
        <span class="ruby-comment"># query_list.push(&#39;%s=%s&#39; % Array[query, slug])</span>
        <span class="ruby-identifier">query_list</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">format</span>(<span class="ruby-string">&#39;%s=%s&#39;</span>, <span class="ruby-identifier">query</span>, <span class="ruby-identifier">slug</span>))
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># Construct the query_string using the list.</span>
    <span class="ruby-comment"># Last character will be an &amp; so we can push the token</span>
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">string</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">query_list</span>
      <span class="ruby-identifier">query_string</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&#39;%s&amp;&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">string</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">query_string</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-create_activity" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_activity</span><span
            class="method-args">(activity)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a
href="TimeSync.html#method-i-create_activity">#create_activity</a>(activity,
slug=nil) Post an activity to <a href="TimeSync.html">TimeSync</a> via a
POST request in a JSON body. This method will return that body in the form
of a list containing a single ruby hash. The hash will contain a
representation of that JSON body if it was successful or error information
if it was not. “activity“ is a ruby hash containing the activity
information to send to <a href="TimeSync.html">TimeSync</a>.</p>
          
          

          
          <div class="method-source-code" id="create_activity-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 230</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_activity</span>(<span class="ruby-identifier">activity</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">create_or_update</span>(<span class="ruby-identifier">activity</span>, <span class="ruby-keyword">nil</span>,
                          <span class="ruby-string">&#39;activity&#39;</span>, <span class="ruby-string">&#39;activities&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-create_or_update" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_or_update</span><span
            class="method-args">(object_fields, identifier, object_name, endpoint, create_object = true)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Create or update an object “object_name“ at specified “endpoint“. This
method will return that object in the form of a list containing a single
ruby hash. The hash will contain a representation of the JSON body returned
by <a href="TimeSync.html">TimeSync</a> if it was successful or error
information if it was not. If “create_object“, then “parameters“ gets
checked for required fields.</p>
          
          

          
          <div class="method-source-code" id="create_or_update-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 910</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_or_update</span>(<span class="ruby-identifier">object_fields</span>, <span class="ruby-identifier">identifier</span>,
                     <span class="ruby-identifier">object_name</span>, <span class="ruby-identifier">endpoint</span>, <span class="ruby-identifier">create_object</span> = <span class="ruby-keyword">true</span>)
  <span class="ruby-comment"># Check that user has authenticated</span>
  <span class="ruby-ivar">@local_auth_error</span> = <span class="ruby-identifier">local_auth_error</span>

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@local_auth_error</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@local_auth_error</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Check that object contains required fields and no bad fields</span>
  <span class="ruby-identifier">field_error</span> = <span class="ruby-identifier">get_field_errors</span>(<span class="ruby-identifier">object_fields</span>, <span class="ruby-identifier">object_name</span>, <span class="ruby-identifier">create_object</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">field_error</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">field_error</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Since this is a POST request, we need an auth and object objects</span>
  <span class="ruby-identifier">values</span> = <span class="ruby-constant">Hash</span>[<span class="ruby-string">&#39;auth&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">token_auth</span>, <span class="ruby-string">&#39;object&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">object_fields</span>].<span class="ruby-identifier">to_json</span>


  <span class="ruby-comment"># Reformat the identifier with the leading &#39;/&#39; so it can be added to</span>
  <span class="ruby-comment"># the url. Do this here instead of the url assignment below so we can</span>
  <span class="ruby-comment"># set it to &#39; if it wasn&#39;t passed.</span>
  <span class="ruby-identifier">identifier</span> = <span class="ruby-identifier">identifier</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;/%s&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">identifier</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>

  <span class="ruby-comment"># Construct url to post to</span>
  <span class="ruby-identifier">url</span> = <span class="ruby-string">&#39;%s/%s%s&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-constant">Array</span>[<span class="ruby-ivar">@baseurl</span>, <span class="ruby-identifier">endpoint</span>, <span class="ruby-identifier">identifier</span>]

  <span class="ruby-comment"># Test mode, remove leading &#39;/&#39; from identifier</span>
  <span class="ruby-identifier">identifier</span>.<span class="ruby-identifier">slice!</span>(<span class="ruby-value">0</span>)
  <span class="ruby-identifier">test_identifier</span> = <span class="ruby-identifier">identifier</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@test</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">test_handler</span>(<span class="ruby-identifier">object_fields</span>, <span class="ruby-identifier">test_identifier</span>, <span class="ruby-identifier">object_name</span>, <span class="ruby-identifier">create_object</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Attempt to POST to TimeSync, then convert the response to a ruby</span>
  <span class="ruby-comment"># hash</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-comment"># Success!</span>
    <span class="ruby-identifier">response</span> = <span class="ruby-constant">RestClient</span>.<span class="ruby-identifier">post</span>(<span class="ruby-identifier">url</span>, <span class="ruby-identifier">values</span>, <span class="ruby-value">:content_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:json</span>, <span class="ruby-value">:accept</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:json</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">response_to_ruby</span>(<span class="ruby-identifier">response</span>.<span class="ruby-identifier">body</span>, <span class="ruby-identifier">response</span>.<span class="ruby-identifier">code</span>)
  <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
    <span class="ruby-comment"># Request error</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-create_project" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_project</span><span
            class="method-args">(project)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a
href="TimeSync.html#method-i-create_project">#create_project</a>(project)
Post a project to <a href="TimeSync.html">TimeSync</a> via a POST request
in a JSON body. This method will return that body in the form of a list
containing a single ruby hash. The hash will contain a representation of
that JSON body if it was successful or error information if it was not.
“project“ is a ruby hash containing the project information to send to <a
href="TimeSync.html">TimeSync</a>.</p>
          
          

          
          <div class="method-source-code" id="create_project-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 205</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_project</span>(<span class="ruby-identifier">project</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">create_or_update</span>(<span class="ruby-identifier">project</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-string">&#39;project&#39;</span>, <span class="ruby-string">&#39;projects&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-create_time" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_time</span><span
            class="method-args">(time)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a href="TimeSync.html#method-i-create_time">#create_time</a>(time) Send a
time entry to <a href="TimeSync.html">TimeSync</a> via a POST request in a
JSON body. This method will return that body in the form of a list
containing a single ruby hash. The hash will contain a representation of
that JSON body if it was successful or error information if it was not.
“time“ is a ruby hash containing the time information to send to <a
href="TimeSync.html">TimeSync</a>.</p>
          
          

          
          <div class="method-source-code" id="create_time-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 151</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_time</span>(<span class="ruby-identifier">time</span>)
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">time</span>[<span class="ruby-string">&#39;duration&#39;</span>].<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Integer</span>
    <span class="ruby-identifier">duration</span> = <span class="ruby-identifier">duration_to_seconds</span>(<span class="ruby-identifier">time</span>[<span class="ruby-string">&#39;duration&#39;</span>])
    <span class="ruby-identifier">time</span>[<span class="ruby-string">&#39;duration&#39;</span>] = <span class="ruby-identifier">duration</span>

    <span class="ruby-comment"># Duration at this point contains an error_msg if it&#39;s not an int</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">time</span>[<span class="ruby-string">&#39;duration&#39;</span>].<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Integer</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">duration</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">time</span>[<span class="ruby-string">&#39;duration&#39;</span>] <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;time object: duration cannot be negative&#39;</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">create_or_update</span>(<span class="ruby-identifier">time</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-string">&#39;time&#39;</span>, <span class="ruby-string">&#39;times&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-create_user" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_user</span><span
            class="method-args">(user)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a href="TimeSync.html#method-i-create_user">#create_user</a>(user) Post a
user to <a href="TimeSync.html">TimeSync</a> via a POST request in a JSON
body. This method will return that body in the form of a list containing a
single ruby hash. The hash will contain a representation of that JSON body
if it was successful or error information if it was not. “user“ is a ruby
hash containing the user information to send to <a
href="TimeSync.html">TimeSync</a>.</p>
          
          

          
          <div class="method-source-code" id="create_user-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 257</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_user</span>(<span class="ruby-identifier">user</span>)
  <span class="ruby-identifier">ary</span> = <span class="ruby-node">%w(site_admin site_manager site_spectator active)</span>
  <span class="ruby-identifier">ary</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">perm</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">perm</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">user</span>[<span class="ruby-identifier">perm</span>].<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Boolean</span>)
      <span class="ruby-keyword">return</span> <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;user object: %s must be True or False&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">perm</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">hash_user_password</span>(<span class="ruby-identifier">user</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">create_or_update</span>(<span class="ruby-identifier">user</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-string">&#39;user&#39;</span>, <span class="ruby-string">&#39;users&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-delete_activity" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete_activity</span><span
            class="method-args">(slug = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a
href="TimeSync.html#method-i-delete_activity">#delete_activity</a>(slug=nil)
Allows the currently authenticated admin user to delete an activity record
by slug. “slug“ is a string containing the slug of the activity to be
deleted.</p>
          
          

          
          <div class="method-source-code" id="delete_activity-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 581</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete_activity</span>(<span class="ruby-identifier">slug</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-comment"># Check that user has authenticated</span>
  <span class="ruby-ivar">@local_auth_error</span> = <span class="ruby-identifier">local_auth_error</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@local_auth_error</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@local_auth_error</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">slug</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;missing slug; please add to method call&#39;</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">delete_object</span>(<span class="ruby-string">&#39;activities&#39;</span>, <span class="ruby-identifier">slug</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-delete_object" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete_object</span><span
            class="method-args">(endpoint, identifier)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Deletes object at “endpoint“ identified by “identifier“</p>
          
          

          
          <div class="method-source-code" id="delete_object-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 983</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete_object</span>(<span class="ruby-identifier">endpoint</span>, <span class="ruby-identifier">identifier</span>)
  <span class="ruby-comment"># Construct url</span>
  <span class="ruby-identifier">url</span> = <span class="ruby-string">&#39;%s/%s/%s?token=%s&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-constant">Array</span>[<span class="ruby-ivar">@baseurl</span>, <span class="ruby-identifier">endpoint</span>, <span class="ruby-identifier">identifier</span>, <span class="ruby-ivar">@token</span>]

  <span class="ruby-comment"># Test mode</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@test</span>
    <span class="ruby-identifier">m</span> = <span class="ruby-constant">MockTimeSync</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">delete_object</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Attempt to DELETE object</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-comment"># Success!</span>
    <span class="ruby-identifier">response</span> = <span class="ruby-constant">RestClient</span>.<span class="ruby-identifier">delete</span> <span class="ruby-identifier">url</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">response_to_ruby</span>(<span class="ruby-identifier">response</span>.<span class="ruby-identifier">body</span>, <span class="ruby-identifier">response</span>.<span class="ruby-identifier">code</span>)
  <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
    <span class="ruby-comment"># Request error</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-delete_project" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete_project</span><span
            class="method-args">(slug = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a
href="TimeSync.html#method-i-delete_project">#delete_project</a>(slug=nil)
Allows the currently authenticated admin user to delete a project record by
slug. “slug“ is a string containing the slug of the project to be deleted.</p>
          
          

          
          <div class="method-source-code" id="delete_project-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 563</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete_project</span>(<span class="ruby-identifier">slug</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-comment"># Check that user has authenticated</span>
  <span class="ruby-ivar">@local_auth_error</span> = <span class="ruby-identifier">local_auth_error</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@local_auth_error</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@local_auth_error</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">slug</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;missing slug; please add to method call&#39;</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">delete_object</span>(<span class="ruby-string">&#39;projects&#39;</span>, <span class="ruby-identifier">slug</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-delete_time" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete_time</span><span
            class="method-args">(uuid = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a href="TimeSync.html#method-i-delete_time">#delete_time</a>(uuid=nil)
Allows the currently authenticated user to delete their own time entry by
uuid. “uuid“ is a string containing the uuid of the time entry to be
deleted.</p>
          
          

          
          <div class="method-source-code" id="delete_time-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 545</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete_time</span>(<span class="ruby-identifier">uuid</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-comment"># Check that user has authenticated</span>
  <span class="ruby-ivar">@local_auth_error</span> = <span class="ruby-identifier">local_auth_error</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@local_auth_error</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@local_auth_error</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">uuid</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;missing uuid; please add to method call&#39;</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">delete_object</span>(<span class="ruby-string">&#39;times&#39;</span>, <span class="ruby-identifier">uuid</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-delete_user" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete_user</span><span
            class="method-args">(username = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a href="TimeSync.html#method-i-delete_user">#delete_user</a>(username=nil)
Allows the currently authenticated admin user to delete a user record by
username. “username“ is a string containing the username of the user to be
deleted.</p>
          
          

          
          <div class="method-source-code" id="delete_user-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 600</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete_user</span>(<span class="ruby-identifier">username</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-comment"># Check that user has authenticated</span>
  <span class="ruby-ivar">@local_auth_error</span> = <span class="ruby-identifier">local_auth_error</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@local_auth_error</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@local_auth_error</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">username</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span>
                    <span class="ruby-string">&#39;missing username; please add to method call&#39;</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">delete_object</span>(<span class="ruby-string">&#39;users&#39;</span>, <span class="ruby-identifier">username</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-duration_to_seconds" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">duration_to_seconds</span><span
            class="method-args">(duration)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>When a time_entry is created, a user will enter a time duration as one of
the parameters of the object. This method will convert that entry (if
it&#39;s entered as a string) into the appropriate integer equivalent (in
seconds).</p>
          
          

          
          <div class="method-source-code" id="duration_to_seconds-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 961</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">duration_to_seconds</span>(<span class="ruby-identifier">duration</span>)
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">t</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">strptime</span>(<span class="ruby-identifier">duration</span>, <span class="ruby-string">&#39;%Hh%Mm&#39;</span>)
    <span class="ruby-identifier">hours_spent</span> = <span class="ruby-identifier">t</span>.<span class="ruby-identifier">hour</span>
    <span class="ruby-identifier">minutes_spent</span> = <span class="ruby-identifier">t</span>.<span class="ruby-identifier">min</span>

    <span class="ruby-identifier">temp</span> = <span class="ruby-string">&quot;%sh%sm&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">hours_spent</span>, <span class="ruby-identifier">minutes_spent</span>]

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">temp</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">duration</span>
        <span class="ruby-identifier">error_msg</span> = [<span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;time object: invalid duration string&quot;</span>]]
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">error_msg</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># Convert duration to seconds</span>
    <span class="ruby-keyword">return</span> (<span class="ruby-identifier">hours_spent</span> <span class="ruby-operator">*</span> <span class="ruby-value">3600</span>) <span class="ruby-operator">+</span> (<span class="ruby-identifier">minutes_spent</span> <span class="ruby-operator">*</span> <span class="ruby-value">60</span>)
  <span class="ruby-keyword">rescue</span>
    <span class="ruby-identifier">error_msg</span> = [<span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;time object: invalid duration string&#39;</span>]]
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">error_msg</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-format_endpoints" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">format_endpoints</span><span
            class="method-args">(queries)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Format endpoints for GET projects and activities requests. Returns nil if
invalid combination of slug and include_deleted</p>
          
          

          
          <div class="method-source-code" id="format_endpoints-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 775</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">format_endpoints</span>(<span class="ruby-identifier">queries</span>)
  <span class="ruby-identifier">query_string</span> = <span class="ruby-string">&#39;?&#39;</span>
  <span class="ruby-identifier">query_list</span> = <span class="ruby-constant">Array</span>[]

  <span class="ruby-comment"># The following combination is not allowed</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">queries</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;slug&#39;</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">queries</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;include_deleted&#39;</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-comment"># slug goes first, then delete it so it doesn&#39;t show up after the ?</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">queries</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;slug&#39;</span>)
    <span class="ruby-comment"># query_string = &#39;/%s?&#39; % queries[&#39;slug&#39;]</span>
    <span class="ruby-identifier">query_string</span> = <span class="ruby-identifier">format</span>(<span class="ruby-string">&#39;/%s?&#39;</span>, <span class="ruby-identifier">queries</span>[<span class="ruby-string">&#39;slug&#39;</span>])
    <span class="ruby-identifier">queries</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&#39;slug&#39;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Convert true and false booleans to TimeSync compatible strings</span>
  <span class="ruby-keyword">for</span> <span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">queries</span>.<span class="ruby-identifier">to_a</span>
    <span class="ruby-identifier">queries</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span> <span class="ruby-operator">?</span> <span class="ruby-string">&quot;true&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;false&quot;</span>
    <span class="ruby-identifier">query_list</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">&quot;%s=%s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-constant">Array</span>[<span class="ruby-identifier">k</span>, <span class="ruby-identifier">queries</span>[<span class="ruby-identifier">k</span>]])
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">query_list</span> = <span class="ruby-identifier">query_list</span>.<span class="ruby-identifier">sort</span>

  <span class="ruby-comment"># Check for items in query_list after slug was removed, create</span>
  <span class="ruby-comment"># query string</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">query_list</span>
    <span class="ruby-comment"># query_string += &#39;%s&amp;&#39; % query_list.join(&#39;&amp;&#39;)</span>
    <span class="ruby-identifier">query_string</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">format</span>(<span class="ruby-string">&#39;%s&amp;&#39;</span>, <span class="ruby-identifier">query_list</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;&amp;&#39;</span>))
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># Authenticate and return</span>
  <span class="ruby-comment"># query_string += &#39;token=%s&#39; % @token</span>
  <span class="ruby-identifier">query_string</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">format</span>(<span class="ruby-string">&#39;token=%s&#39;</span>, <span class="ruby-ivar">@token</span>)
  <span class="ruby-identifier">query_string</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_activities" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_activities</span><span
            class="method-args">(query_parameters = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a
href="TimeSync.html#method-i-get_activities">#get_activities</a>(query_parameters)
Request activity information filtered by parameters passed to
“query_parameters“. Returns a list of ruby objects representing the JSON
activity information returned by <a href="TimeSync.html">TimeSync</a> or an
error message if unsuccessful. “query_parameters“ is a hash containing the
optional query parameters described in the <a
href="TimeSync.html">TimeSync</a> documentation. If “query_parameters“ is
empty or nil, “get_activities“ will return all activities in the database.
The syntax for each argument is “{&#39;query&#39;: &#39;parameter&#39;}“ or
“{&#39;bool_query&#39;: &lt;boolean&gt;}“. Optional parameters:
&#39;slug&#39;: &#39;&lt;slug&gt;&#39; &#39;include_deleted&#39;:
&lt;boolean&gt; &#39;revisions&#39;: &lt;boolean&gt; Does not accept a slug
combined with include_deleted, but does accept any other combination.</p>
          
          

          
          <div class="method-source-code" id="get_activities-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 440</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_activities</span>(<span class="ruby-identifier">query_parameters</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-comment"># Check that user has authenticated</span>
  <span class="ruby-ivar">@local_auth_error</span> = <span class="ruby-identifier">local_auth_error</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@local_auth_error</span>
    <span class="ruby-keyword">return</span> [<span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@local_auth_error</span>]]
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Save for passing to test mode since format_endpoints deletes</span>
  <span class="ruby-comment"># kwargs[&#39;slug&#39;] if it exists</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">query_parameters</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">query_parameters</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;slug&#39;</span>)
    <span class="ruby-identifier">slug</span> = <span class="ruby-identifier">query_parameters</span>[<span class="ruby-string">&#39;slug&#39;</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">slug</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">query_string</span> = <span class="ruby-string">&#39;&#39;</span>

  <span class="ruby-comment"># If kwargs exist, create a correct query string</span>
  <span class="ruby-comment"># Else, prepare query_string for the token</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">query_parameters</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">query_string</span> = <span class="ruby-identifier">format_endpoints</span>(<span class="ruby-identifier">query_parameters</span>)
    <span class="ruby-comment"># If format_endpoints returns nil, it was passed both slug and</span>
    <span class="ruby-comment"># include_deleted, which is not allowed by the TimeSync API</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">query_string</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">error_message</span> = <span class="ruby-string">&#39;invalid combination: slug and include_deleted&#39;</span>
      <span class="ruby-keyword">return</span> [<span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">error_message</span>]]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">query_string</span> = <span class="ruby-string">&#39;?token=%s&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-ivar">@token</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Construct query url - at this point query_string ends with</span>
  <span class="ruby-comment"># ?token=token</span>
  <span class="ruby-identifier">url</span> = <span class="ruby-string">&#39;%s/activities%s&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-constant">Array</span>[<span class="ruby-ivar">@baseurl</span>, <span class="ruby-identifier">query_string</span>]

  <span class="ruby-comment"># Test mode, return list of projects if slug is nil, or a list of</span>
  <span class="ruby-comment"># projects</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@test</span>
    <span class="ruby-identifier">m</span> = <span class="ruby-constant">MockTimeSync</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">get_activities</span>(<span class="ruby-identifier">slug</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Attempt to GET activities, then convert the response to a ruby</span>
  <span class="ruby-comment"># hash. Always returns a list.</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-comment"># Success!</span>
    <span class="ruby-identifier">response</span> = <span class="ruby-constant">RestClient</span>.<span class="ruby-identifier">get</span> <span class="ruby-identifier">url</span>
    <span class="ruby-identifier">res_dict</span> = <span class="ruby-identifier">response_to_ruby</span>(<span class="ruby-identifier">response</span>.<span class="ruby-identifier">body</span>, <span class="ruby-identifier">response</span>.<span class="ruby-identifier">code</span>)
    <span class="ruby-keyword">return</span> (<span class="ruby-identifier">res_dict</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">res_dict</span> <span class="ruby-operator">:</span> [<span class="ruby-identifier">res_dict</span>])
  <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
    <span class="ruby-comment"># Request Error</span>
    <span class="ruby-keyword">return</span> [<span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>]]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_field_errors" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_field_errors</span><span
            class="method-args">(actual, object_name, create_object)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Checks that “actual“ parameter passed to POST method contains items in
required or optional lists for that “object_name“. Returns nil if no errors
found or error string if error found. If “create_object“ then “actual“ gets
checked for required fields</p>
          
          

          
          <div class="method-source-code" id="get_field_errors-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 867</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_field_errors</span>(<span class="ruby-identifier">actual</span>, <span class="ruby-identifier">object_name</span>, <span class="ruby-identifier">create_object</span>)
  <span class="ruby-comment"># Check that actual is a ruby dict</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">actual</span>.<span class="ruby-identifier">is_a?</span> (<span class="ruby-constant">Hash</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-string">&#39;%s object: must be ruby hash&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">object_name</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># missing_list contains a list of all the required parameters that were</span>
  <span class="ruby-comment"># not passed. It is initialized to all required parameters.</span>
  <span class="ruby-identifier">missing_list</span> = <span class="ruby-ivar">@required_params</span>[<span class="ruby-identifier">object_name</span>].<span class="ruby-identifier">clone</span>

  <span class="ruby-comment"># For each key, if it is not required or optional, it is not allowed</span>
  <span class="ruby-comment"># If it is requried, remove that parameter from the missing_list, since</span>
  <span class="ruby-comment"># it is no longer missing</span>
  <span class="ruby-comment"># actual.each do |key, value|</span>

  <span class="ruby-keyword">for</span> <span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">actual</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@required_params</span>[<span class="ruby-identifier">object_name</span>].<span class="ruby-identifier">include?</span><span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-keyword">and</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@optional_params</span>[<span class="ruby-identifier">object_name</span>].<span class="ruby-identifier">include?</span><span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>
      <span class="ruby-keyword">return</span> <span class="ruby-string">&#39;%s object: invalid field: %s&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-constant">Array</span>[<span class="ruby-identifier">object_name</span>, <span class="ruby-identifier">key</span>]
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># Remove field from copied list if the field is in required</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@required_params</span>[<span class="ruby-identifier">object_name</span>].<span class="ruby-identifier">include?</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>
      <span class="ruby-comment"># missing_list.delete(key.to_s)</span>
      <span class="ruby-identifier">missing_list</span>.<span class="ruby-identifier">delete_at</span>(<span class="ruby-identifier">missing_list</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>))
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># If there is anything in missing_list, it is an absent required field</span>
  <span class="ruby-comment"># This only needs to be checked if the create_object flag is passed</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">create_object</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">missing_list</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-string">&#39;%s object: missing required field(s): %s&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-constant">Array</span>[
        <span class="ruby-identifier">object_name</span>, <span class="ruby-identifier">missing_list</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;, &#39;</span>)]
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># No errors if we made it this far</span>
  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_projects" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_projects</span><span
            class="method-args">(query_parameters = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a
href="TimeSync.html#method-i-get_projects">#get_projects</a>(query_parameters)
Request project information filtered by parameters passed to
“query_parameters“. Returns a list of ruby objects representing the JSON
project information returned by <a href="TimeSync.html">TimeSync</a> or an
error message if unsuccessful. “query_parameters“ is a ruby dict containing
the optional query parameters described in the <a
href="TimeSync.html">TimeSync</a> documentation. If “query_parameters“ is
empty or nil, “get_projects“ will return all projects in the database. The
syntax for each argument is “{&#39;query&#39;: &#39;parameter&#39;}“ or
“{&#39;bool_query&#39;: &lt;boolean&gt;}“. Optional parameters:
&#39;slug&#39;: &#39;&lt;slug&gt;&#39; &#39;include_deleted&#39;:
&lt;boolean&gt; &#39;revisions&#39;: &lt;boolean&gt; Does not accept a slug
combined with include_deleted, but does accept any other combination.</p>
          
          

          
          <div class="method-source-code" id="get_projects-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 369</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_projects</span>(<span class="ruby-identifier">query_parameters</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-comment"># Check that user has authenticated</span>
  <span class="ruby-ivar">@local_auth_error</span> = <span class="ruby-identifier">local_auth_error</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@local_auth_error</span>
    <span class="ruby-keyword">return</span> [<span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@local_auth_error</span>]]
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Save for passing to test mode since format_endpoints deletes</span>
  <span class="ruby-comment"># kwargs[&#39;slug&#39;] if it exists</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">query_parameters</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">query_parameters</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;slug&#39;</span>)
    <span class="ruby-identifier">slug</span> = <span class="ruby-identifier">query_parameters</span>[<span class="ruby-string">&#39;slug&#39;</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">slug</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">query_string</span> = <span class="ruby-string">&#39;&#39;</span>

  <span class="ruby-comment"># If kwargs exist, create a correct query string</span>
  <span class="ruby-comment"># Else, prepare query_string for the token</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">query_parameters</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">query_string</span> = <span class="ruby-identifier">format_endpoints</span>(<span class="ruby-identifier">query_parameters</span>)
    <span class="ruby-comment"># If format_endpoints returns nil, it was passed both slug and</span>
    <span class="ruby-comment"># include_deleted, which is not allowed by the TimeSync API</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">query_string</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">error_message</span> = <span class="ruby-string">&#39;invalid combination: slug and include_deleted&#39;</span>
      <span class="ruby-keyword">return</span> [<span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">error_message</span>]]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">query_string</span> = <span class="ruby-string">&#39;?token=%s&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-ivar">@token</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Construct query url - at this point query_string ends with</span>
  <span class="ruby-comment"># ?token=token</span>
  <span class="ruby-identifier">url</span> = <span class="ruby-string">&#39;%s/projects%s&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-constant">Array</span>[<span class="ruby-ivar">@baseurl</span>, <span class="ruby-identifier">query_string</span>]

  <span class="ruby-comment"># Test mode, return list of projects if slug is nil, or a single</span>
  <span class="ruby-comment"># project</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@test</span>
    <span class="ruby-identifier">m</span> = <span class="ruby-constant">MockTimeSync</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">get_projects</span>(<span class="ruby-identifier">slug</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Attempt to GET projects, then convert the response to a ruby</span>
  <span class="ruby-comment"># hash. Always returns a list.</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-comment"># Success!</span>
    <span class="ruby-identifier">response</span> = <span class="ruby-constant">RestClient</span>.<span class="ruby-identifier">get</span> <span class="ruby-identifier">url</span>
    <span class="ruby-identifier">res_dict</span> = <span class="ruby-identifier">response_to_ruby</span>(<span class="ruby-identifier">response</span>.<span class="ruby-identifier">body</span>, <span class="ruby-identifier">response</span>.<span class="ruby-identifier">code</span>)
    <span class="ruby-keyword">return</span> (<span class="ruby-identifier">res_dict</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">res_dict</span> <span class="ruby-operator">:</span> [<span class="ruby-identifier">res_dict</span>])
  <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
    <span class="ruby-comment"># Request Error</span>
    <span class="ruby-keyword">return</span> [<span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>]]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_times" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_times</span><span
            class="method-args">(query_parameters = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a href="TimeSync.html#method-i-get_times">#get_times</a>(query_parameters)
Request time entries filtered by parameters passed in “query_parameters“.
Returns a list of ruby objects representing the JSON time information
returned by <a href="TimeSync.html">TimeSync</a> or an error message if
unsuccessful. “query_parameters“ is a ruby hash containing the optional
query parameters described in the <a href="TimeSync.html">TimeSync</a>
documentation. If “query_parameters“ is empty or nil, “get_times“ will
return all times in the database. The syntax for each argument is
“{&#39;query&#39;: [&#39;parameter&#39;]}“.</p>
          
          

          
          <div class="method-source-code" id="get_times-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 300</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_times</span>(<span class="ruby-identifier">query_parameters</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-comment"># Check that user has authenticated</span>
  <span class="ruby-ivar">@local_auth_error</span> = <span class="ruby-identifier">local_auth_error</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@local_auth_error</span>
    <span class="ruby-keyword">return</span> [<span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@local_auth_error</span>]]
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Check for key error</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">query_parameters</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">query_parameters</span>
      <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@valid_get_queries</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">key</span>)
        <span class="ruby-keyword">return</span> [<span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;invalid query: %s&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">key</span>]]
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Initialize the query string</span>
  <span class="ruby-identifier">query_string</span> = <span class="ruby-string">&#39;&#39;</span>

  <span class="ruby-comment"># If there are filtering parameters, construct them correctly.</span>
  <span class="ruby-comment"># Else reinitialize the query string to a ? so we can add the token.</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">query_parameters</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">query_string</span> = <span class="ruby-identifier">construct_filter_query</span>(<span class="ruby-identifier">query_parameters</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">query_string</span> = <span class="ruby-string">&#39;?&#39;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Construct query url, at this point query_string ends with a ?</span>
  <span class="ruby-identifier">url</span> = <span class="ruby-string">&#39;%s/times%stoken=%s&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-constant">Array</span>[<span class="ruby-ivar">@baseurl</span>, <span class="ruby-identifier">query_string</span>, <span class="ruby-ivar">@token</span>]

  <span class="ruby-comment"># Test mode, return one or many objects depending on if uuid is passed</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@test</span>
    <span class="ruby-identifier">m</span> = <span class="ruby-constant">MockTimeSync</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">query_parameters</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">query_parameters</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;uuid&#39;</span>)
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">get_times</span>(<span class="ruby-identifier">query_parameters</span>[<span class="ruby-string">&#39;uuid&#39;</span>])
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">get_times</span>(<span class="ruby-keyword">nil</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Attempt to GET times, then convert the response to a ruby</span>
  <span class="ruby-comment"># hash. Always returns a list.</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-comment"># Success!</span>
    <span class="ruby-identifier">response</span> = <span class="ruby-constant">RestClient</span>.<span class="ruby-identifier">get</span> <span class="ruby-identifier">url</span>
    <span class="ruby-identifier">res_dict</span> = <span class="ruby-identifier">response_to_ruby</span>(<span class="ruby-identifier">response</span>.<span class="ruby-identifier">body</span>, <span class="ruby-identifier">response</span>.<span class="ruby-identifier">code</span>)
    <span class="ruby-keyword">return</span> (<span class="ruby-identifier">res_dict</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">res_dict</span> <span class="ruby-operator">:</span> [<span class="ruby-identifier">res_dict</span>])
  <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
    <span class="ruby-comment"># Request Error</span>
    <span class="ruby-keyword">return</span> [<span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>]]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_users" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_users</span><span
            class="method-args">(username = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>“username“ is an optional parameter containing a string of the specific
username to be retrieved. If “username“ is not provided, a list containing
all users will be returned. Defaults to “nil“.</p>
          
          

          
          <div class="method-source-code" id="get_users-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 505</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_users</span>(<span class="ruby-identifier">username</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-comment"># Check that user has authenticated</span>
  <span class="ruby-ivar">@local_auth_error</span> = <span class="ruby-identifier">local_auth_error</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@local_auth_error</span>
    <span class="ruby-keyword">return</span> [<span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@local_auth_error</span>]]
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># url should end with /users if no username is passed else</span>
  <span class="ruby-comment"># /users/username</span>
  <span class="ruby-identifier">url</span> = <span class="ruby-identifier">username</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;%s/users/%s&#39;</span> <span class="ruby-operator">%</span> [<span class="ruby-ivar">@baseurl</span>, <span class="ruby-identifier">username</span>] <span class="ruby-operator">:</span> <span class="ruby-string">&#39;%s/users&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-ivar">@baseurl</span>

  <span class="ruby-comment"># The url should always end with a token</span>
  <span class="ruby-identifier">url</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&#39;?token=%s&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-ivar">@token</span>

  <span class="ruby-comment"># Test mode, return one user object if username is passed else return</span>
  <span class="ruby-comment"># several user objects</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@test</span>
    <span class="ruby-identifier">m</span> = <span class="ruby-constant">MockTimeSync</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">get_users</span>(<span class="ruby-identifier">username</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Attempt to GET users, then convert the response to a ruby</span>
  <span class="ruby-comment"># hash. Always returns a list.</span>

  <span class="ruby-keyword">begin</span>
    <span class="ruby-comment"># Success!</span>
    <span class="ruby-identifier">response</span> = <span class="ruby-constant">RestClient</span>.<span class="ruby-identifier">get</span> <span class="ruby-identifier">url</span>
    <span class="ruby-identifier">res_dict</span> = <span class="ruby-identifier">response_to_ruby</span>(<span class="ruby-identifier">response</span>.<span class="ruby-identifier">body</span>, <span class="ruby-identifier">response</span>.<span class="ruby-identifier">code</span>)
    <span class="ruby-keyword">return</span> (<span class="ruby-identifier">res_dict</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">res_dict</span> <span class="ruby-operator">:</span> [<span class="ruby-identifier">res_dict</span>])
  <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
    <span class="ruby-comment"># Request Error</span>
    <span class="ruby-keyword">return</span> [<span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>]]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-hash_user_password" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">hash_user_password</span><span
            class="method-args">(user)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Hashes the password field in a user object. If the password is Unicode,
encode it to UTF-8 first</p>
          
          

          
          <div class="method-source-code" id="hash_user_password-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 737</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">hash_user_password</span>(<span class="ruby-identifier">user</span>)
  <span class="ruby-comment"># Only hash password if it is present</span>
  <span class="ruby-comment"># Don&#39;t error out here so that internal methods can catch all missing</span>
  <span class="ruby-comment"># fields later on and return a more meaningful error if necessary.</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;password&#39;</span>)
    <span class="ruby-identifier">password</span> = <span class="ruby-identifier">user</span>[<span class="ruby-string">&#39;password&#39;</span>]

    <span class="ruby-comment"># Hash the password</span>
    <span class="ruby-identifier">hashed</span> = <span class="ruby-constant">BCrypt</span><span class="ruby-operator">::</span><span class="ruby-constant">Password</span>.<span class="ruby-identifier">create</span>(<span class="ruby-string">&#39;password&#39;</span>)

    <span class="ruby-identifier">user</span>[<span class="ruby-string">&#39;password&#39;</span>] = <span class="ruby-identifier">hashed</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-local_auth_error" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">local_auth_error</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Checks that token is set. Returns error if not set, otherwise returns nil</p>
          
          

          
          <div class="method-source-code" id="local_auth_error-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 731</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">local_auth_error</span>
  <span class="ruby-keyword">return</span> (<span class="ruby-ivar">@token</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> (<span class="ruby-string">&#39;Not authenticated with TimeSync, call authenticate first&#39;</span>))
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-project_users" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">project_users</span><span
            class="method-args">(project = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a href="TimeSync.html#method-i-project_users">#project_users</a>(project)
Returns a dict of users for the specified project containing usernames
mapped to their list of permissions for the project.</p>
          
          

          
          <div class="method-source-code" id="project_users-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 656</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">project_users</span>(<span class="ruby-identifier">project</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-comment"># Check that user has authenticated</span>
  <span class="ruby-ivar">@local_auth_error</span> = <span class="ruby-identifier">local_auth_error</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@local_auth_error</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@local_auth_error</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Check that a project slug was passed</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">project</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;Missing project slug, please include in method call&#39;</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Construct query url</span>
  <span class="ruby-identifier">url</span> = <span class="ruby-string">&#39;%s/projects/%s?token=%s&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-constant">Array</span>[<span class="ruby-ivar">@baseurl</span>, <span class="ruby-identifier">project</span>, <span class="ruby-ivar">@token</span>]
  <span class="ruby-comment"># Return valid user object if in test mode</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@test</span>
    <span class="ruby-identifier">m</span> = <span class="ruby-constant">MockTimeSync</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">project_users</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># Try to get the project object</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-comment"># Success!</span>
    <span class="ruby-identifier">response</span> = <span class="ruby-constant">RestClient</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">url</span>)
    <span class="ruby-identifier">project_object</span> = <span class="ruby-identifier">response_to_ruby</span>(<span class="ruby-identifier">response</span>.<span class="ruby-identifier">body</span>, <span class="ruby-identifier">response</span>.<span class="ruby-identifier">code</span>)
  <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
    <span class="ruby-comment"># Request Error</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Create the user dict to return</span>
  <span class="ruby-comment"># There was an error, don&#39;t do anything with it, return as a list</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">project_object</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;error&#39;</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">project_object</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Get the user object from the project</span>
  <span class="ruby-identifier">users</span> = <span class="ruby-identifier">project_object</span>[<span class="ruby-string">&#39;users&#39;</span>]

  <span class="ruby-comment"># Convert the nested permissions dict to a list containing only</span>
  <span class="ruby-comment"># relevant (true) permissions</span>

  <span class="ruby-identifier">rv</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>

  <span class="ruby-keyword">for</span> <span class="ruby-identifier">user</span>, <span class="ruby-identifier">permissions</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">users</span>
    <span class="ruby-identifier">rv_perms</span> = <span class="ruby-constant">Array</span>[]
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">perm</span>, <span class="ruby-identifier">value</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">permissions</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">value</span>
        <span class="ruby-identifier">rv_perms</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">perm</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">rv</span>[<span class="ruby-identifier">user</span>] = <span class="ruby-identifier">rv_perms</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">rv</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-response_to_ruby" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">response_to_ruby</span><span
            class="method-args">(body, code)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Convert response to native ruby list of objects</p>
          
          

          
          <div class="method-source-code" id="response_to_ruby-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 752</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">response_to_ruby</span>(<span class="ruby-identifier">body</span>, <span class="ruby-identifier">code</span>)
  <span class="ruby-comment"># Body should always be a string</span>
  <span class="ruby-comment"># DELETE returns an empty body if successful</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">body</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">code</span> <span class="ruby-operator">==</span> <span class="ruby-value">200</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">Hash</span>[<span class="ruby-string">&#39;status&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">200</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># If body is valid JSON, it came from TimeSync. If it isn&#39;t</span>
  <span class="ruby-comment"># and we got a ValueError, we know we are having trouble connecting to</span>
  <span class="ruby-comment"># TimeSync because we are not getting a return from TimeSync.</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">ruby_object</span> = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">load</span>(<span class="ruby-identifier">body</span>)
  <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
    <span class="ruby-comment"># If we get a ValueError, body isn&#39;t a JSON object, and</span>
    <span class="ruby-comment"># therefore didn&#39;t come from a TimeSync connection.</span>
    <span class="ruby-identifier">err_msg</span> = <span class="ruby-string">&#39;connection to TimeSync failed at baseurl %s - &#39;</span> <span class="ruby-operator">%</span> <span class="ruby-ivar">@baseurl</span>
    <span class="ruby-identifier">err_msg</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&#39;response status was %s&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">code</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err_msg</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">ruby_object</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test_handler" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test_handler</span><span
            class="method-args">(parameters, identifier, obj_name, create_object)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Handle test methods in test mode for creating or updating an object</p>
          
          

          
          <div class="method-source-code" id="test_handler-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 1005</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test_handler</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">identifier</span>, <span class="ruby-identifier">obj_name</span>, <span class="ruby-identifier">create_object</span>)
  <span class="ruby-identifier">m</span> = <span class="ruby-constant">MockTimeSync</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">obj_name</span>

  <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;time&#39;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">create_object</span>
      <span class="ruby-comment"># return mock_rimesync.create_time(parameters)</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">create_time</span>(<span class="ruby-identifier">parameters</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment"># return mock_rimesync.update_time(parameters, identifier)</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">update_time</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">identifier</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;project&#39;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">create_object</span>
      <span class="ruby-comment"># return mock_rimesync.create_project(parameters)</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">create_project</span>(<span class="ruby-identifier">parameters</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment"># return mock_rimesync.update_project(parameters, identifier)</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">update_project</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">identifier</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;activity&#39;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">create_object</span>
      <span class="ruby-comment"># return mock_rimesync.create_activity(parameters)</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">create_activity</span>(<span class="ruby-identifier">parameters</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment"># return mock_rimesync.update_activity(parameters, identifier)</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">update_activity</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">identifier</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;user&#39;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">create_object</span>
      <span class="ruby-comment"># return mock_rimesync.create_user(parameters)</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">create_user</span>(<span class="ruby-identifier">parameters</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment"># return mock_rimesync.update_user(parameters, identifier)</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">update_user</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">identifier</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-token_auth" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">token_auth</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns auth object with a token to send to <a
href="TimeSync.html">TimeSync</a> endpoints</p>
          
          

          
          <div class="method-source-code" id="token_auth-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 724</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">token_auth</span>
  <span class="ruby-constant">Hash</span>[<span class="ruby-string">&#39;type&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;token&#39;</span>,
       <span class="ruby-string">&#39;token&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@token</span>,]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-token_expiration_time" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">token_expiration_time</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a
href="TimeSync.html#method-i-token_expiration_time">#token_expiration_time</a>
Returns the expiration time of the JWT (JSON Web Token) associated with
this object.</p>
          
          

          
          <div class="method-source-code" id="token_expiration_time-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 618</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">token_expiration_time</span>
  <span class="ruby-comment"># Check that user has authenticated</span>
  <span class="ruby-ivar">@local_auth_error</span> = <span class="ruby-identifier">local_auth_error</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@local_auth_error</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@local_auth_error</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Return valid date if in test mode</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@test</span>
    <span class="ruby-identifier">m</span> = <span class="ruby-constant">MockTimeSync</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">token_expiration_time</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Decode the token, then get the second dict (payload) from the</span>
  <span class="ruby-comment"># resulting string. The payload contains the expiration time.</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">decoded_payload</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span>(<span class="ruby-ivar">@token</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;.&#39;</span>)[<span class="ruby-value">1</span>])
  <span class="ruby-keyword">rescue</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;improperly encoded token&#39;</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># literal_eval the string representation of a dict to convert it to a</span>
  <span class="ruby-comment"># dict, then get the value at &#39;exp&#39;. The value at &#39;exp&#39; is epoch time</span>
  <span class="ruby-comment"># in ms</span>
  <span class="ruby-identifier">exp_int</span> = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">load</span>(<span class="ruby-identifier">decoded_payload</span>)[<span class="ruby-string">&#39;exp&#39;</span>] <span class="ruby-comment"># not sure about this</span>

  <span class="ruby-comment"># Convert the epoch time from ms to s</span>
  <span class="ruby-identifier">exp_int</span> <span class="ruby-operator">/=</span> <span class="ruby-value">1000</span>

  <span class="ruby-comment"># Convert and format the epoch time to ruby datetime.</span>
  <span class="ruby-identifier">exp_datetime</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">exp_int</span>)

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">exp_datetime</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update_activity" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_activity</span><span
            class="method-args">(activity, slug)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a
href="TimeSync.html#method-i-update_activity">#update_activity</a>(activity,
slug) Send an activity update to <a href="TimeSync.html">TimeSync</a> via a
POST request in a JSON body. This method will return that body in the form
of a list containing a single ruby hash. The hash will contain a
representation of that updated activity object if it was successful or
error information if it was not. “activity“ is a ruby hash containing the
project information to send to <a href="TimeSync.html">TimeSync</a>. “slug“
contains the slug for an activity entry to update.</p>
          
          

          
          <div class="method-source-code" id="update_activity-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 244</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_activity</span>(<span class="ruby-identifier">activity</span>, <span class="ruby-identifier">slug</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">create_or_update</span>(<span class="ruby-identifier">activity</span>, <span class="ruby-identifier">slug</span>,
                          <span class="ruby-string">&#39;activity&#39;</span>, <span class="ruby-string">&#39;activities&#39;</span>,
                          <span class="ruby-keyword">false</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update_project" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_project</span><span
            class="method-args">(project, slug)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a
href="TimeSync.html#method-i-update_project">#update_project</a>(project,
slug) Send a project update to <a href="TimeSync.html">TimeSync</a> via a
POST request in a JSON body. This method will return that body in the form
of a list containing a single ruby hash. The hash will contain a
representation of that updated project object if it was successful or error
information if it was not. “project“ is a ruby hash containing the project
information to send to <a href="TimeSync.html">TimeSync</a>. “slug“
contains the slug for a project entry to update.</p>
          
          

          
          <div class="method-source-code" id="update_project-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 218</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_project</span>(<span class="ruby-identifier">project</span>, <span class="ruby-identifier">slug</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">create_or_update</span>(<span class="ruby-identifier">project</span>, <span class="ruby-identifier">slug</span>, <span class="ruby-string">&#39;project&#39;</span>, <span class="ruby-string">&#39;projects&#39;</span>,
                          <span class="ruby-keyword">false</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update_time" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_time</span><span
            class="method-args">(time, uuid)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a href="TimeSync.html#method-i-update_time">#update_time</a>(time, uuid)
Send a time entry update to <a href="TimeSync.html">TimeSync</a> via a POST
request in a JSON body. This method will return that body in the form of a
list containing a single ruby hash. The hash will contain a representation
of that updated time object if it was successful or error information if it
was not. “time“ is a ruby hash containing the time information to send to
<a href="TimeSync.html">TimeSync</a>. “uuid“ contains the uuid for a time
entry to update.</p>
          
          

          
          <div class="method-source-code" id="update_time-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 178</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_time</span>(<span class="ruby-identifier">time</span>, <span class="ruby-identifier">uuid</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;duration&#39;</span>)
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">time</span>[<span class="ruby-string">&#39;duration&#39;</span>].<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Integer</span>
      <span class="ruby-identifier">duration</span> = <span class="ruby-identifier">duration_to_seconds</span>(<span class="ruby-identifier">time</span>[<span class="ruby-string">&#39;duration&#39;</span>])
      <span class="ruby-identifier">time</span>[<span class="ruby-string">&#39;duration&#39;</span>] = <span class="ruby-identifier">duration</span>

      <span class="ruby-comment"># Duration at this point contains an error_msg if not an int</span>
      <span class="ruby-keyword">unless</span> <span class="ruby-identifier">time</span>[<span class="ruby-string">&#39;duration&#39;</span>].<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Integer</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">duration</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">time</span>[<span class="ruby-string">&#39;duration&#39;</span>] <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span>
      <span class="ruby-keyword">return</span> <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;time object: duration cannot be negative&#39;</span>]
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">create_or_update</span>(<span class="ruby-identifier">time</span>, <span class="ruby-identifier">uuid</span>, <span class="ruby-string">&#39;time&#39;</span>, <span class="ruby-string">&#39;times&#39;</span>, <span class="ruby-keyword">false</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update_user" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_user</span><span
            class="method-args">(user, username)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a href="TimeSync.html#method-i-update_user">#update_user</a>(user,
username) Send a user update to <a href="TimeSync.html">TimeSync</a> via a
POST request in a JSON body. This method will return that body in the form
of a list containing a single ruby hash. The hash will contain a
representation of that updated user object if it was successful or error
information if it was not. “user“ is a ruby hash containing the user
information to send to <a href="TimeSync.html">TimeSync</a>. “username“
contains the username for a user to update.</p>
          
          

          
          <div class="method-source-code" id="update_user-source">
            <pre><span class="ruby-comment"># File lib/rimesync.rb, line 278</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_user</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">username</span>)
  <span class="ruby-identifier">ary</span> = <span class="ruby-node">%w(site_admin site_manager site_spectator active)</span>
  <span class="ruby-identifier">ary</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">perm</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">perm</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">user</span>[<span class="ruby-identifier">perm</span>].<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Boolean</span>)
      <span class="ruby-keyword">return</span> <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;user object: %s must be True or False&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">perm</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">hash_user_password</span>(<span class="ruby-identifier">user</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">create_or_update</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">username</span>, <span class="ruby-string">&#39;user&#39;</span>, <span class="ruby-string">&#39;users&#39;</span>, <span class="ruby-keyword">false</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

